# vlamax
# VlaMax Calculator

Link: https://konaendurance.com/vlamaxcalc/


Hey folks, 

here are the formulas I used for the calculator: 

# 1. we calculate VLaMAx with the help of bodyweight & height and then go on to calculate VO2ss:

//
const bmi = bodyMass / ((height / 100) ** 2);
const workload = (workload3min + workload6min) / 3;
const volRel = workload / bodyMass;
const vlamax = (0.02049 / volRel) * vo2max * (bmi / 22);


VO2ss describes the steady state oxygen uptake in (ml/ kg*min) and is generated by a sequential array within the boundary of Vo2Max. At this point it is worth mentioning that the oxygen steady state uptake for intensities above the AT will not be maintained in experimental data due to the developing slow component. Consequently the oxygen steady state uptake for intensities above the AT is theoretical.


  // Generate oxygen steady-states
  let VO2ss = [];
  for (let i = 1; i < vo2max; i += 0.01) {
    VO2ss.push(i);
  }
  
  
  
  
# 2. We use Vo2ss with the help of Vo2Max from the input mask and go on to calculate ADP:

(During exercise ATP is converted to ADP (and AMP) to yield energy. In this model the activation of glycolysis occurs in an allosteric relation to ADP and AMP. It is stated, that AMP is proportional to ADPÂ². Therefore, ADP x AMP is equivalent to the third power of ADP. ADP and AMP must be multiplied because the activation due to AMP is amplified. Consequently, the activation of glycolysis can be calculated from ADP)

  // Calculate ADP
  const ADP = VO2ss.map((vo2) => Math.sqrt((Ks1 * vo2) / (vo2max - vo2)));



# 3. Now we use Michaelis-Menten Kinetic as an assumption: Describes the activity of an enzyme as a function of the substrate concentration.

vlass with multiplier 60 to get minutes instead of seconds

  // calculate steady state gross lactic acid (pyruvate) formation rate
  const vLass = ADP.map((adp, index) => 60 * vlamax / (1 + (Ks2 / (adp ** 3))));




# 4. Lactate formation and combustion

As produced pyruvate (or lactate) can be combusted, the net formation rate of lactate (eg, what is measured) is the difference between produced and combusted lactate. In order to relate to the combustion of lactate, we must assess the influence of the energy charge of lactic acid formation and combustion and the distribution to the body's water compartment.  

Net gain of 17 mol ATP per mol lactate -> 1 mmol lactate requires 70.8 ml oxygen, or 1 ml oxygen oxidizes 0.01576 mmol lactate or pyruvate. For further calculations the value of 0.01576 mmol oxidized lactate per 1 ml oxygen will be used.

We must keep in mind, that the change of the lactate distribution in tissue blood depends on the distribution volume in reference to the total space. The available distribution space of lactate is supposedly 45% (VolRel) of the entire body mass. Following this rationale the maximum number of lactate that can be combusted for a given VO2ss is a linear function of VO2ss:

  // Calculate LaComb
  const LaComb = VO2ss.map((vo2) => (0.01576 / VolRel) * vo2);




# 5. In order to calculate the oxygen consumption based on the external load the anaerobic energy contribution needs to be respected. Consequently the earlier calculated lactate/pyruvate production needs to be converted into oxygen-equivalents. This method allows the definition of oxygen-demand per unit of external load.

  // Calculate overall demand and Intensity
  const overall_demand = vLass.map((vl, index) => ((vl * (VolRel * bw) * ((1 / 4.3) * 22.4) / bw) + VO2ss[index]));
  const Intensity = overall_demand.map(od => od / Watt_O2);





# 6. The crossing point: "Anaerobic Threshold"
As we have indicated earlier, the actual net lactate formation can now be calculated as the difference between lactate formation and combustion (see eq. 6 and 7). In the following step all simulated values are plotted together. The crossing point between the gross lactate formation and potential lactate removal indicates the AT. Net lactate production at this point is equal to zero. Below the crossing point vLanet describes the lack of pyruvate. This displays the possible use of fatty acids as pyruvate equivalents. Therefore, the maximum lack of pyruvate represents the point of maximal fuel supply by fatty acids


  // Calculate vLanet
  const vLanet = vLass.map((vl, index) => Math.abs(vl - LaComb[index]));


  // Find the anaerobic threshold
  const arg_sAT = vLanet.indexOf(Math.min(...vLanet));
  const sAT = Intensity[arg_sAT];


  // Calculate s_Fmx and pcVO2maxAT
 const s_Fmx = vLanet.slice(0, arg_sAT).reduce((max, x, i, arr) => (x > arr[max]) ? i : max, 0);
  const pcVO2maxAT = sAT * Watt_O2 / vo2max;
  
  
  
# 7. Macronutrient utilization
Based on the pyruvate production and lack of pyruvate rate the utilization of fatty acids and carbohydrates can be calculated. In this notebook the output unit will be g/h.

The following calculations consider that 1 mol pyruvate requires 0.5 mol glucose. The weight of 1 mol glucose is 162.14 g. The calculated CarbMax value represents the velocity at which 90 g/h of glucose are combusted. Moreover 1L of oxygen produces 4.65 kcal burning fats, whereas 1 kcal has the weight of 9.5g (considering stearate as the main fatty acid used).
  
  const CHO_util = vLass.slice(0, arg_sAT + 400).map(vl => (bw * VolRel) * 60 / 1000 / 2 * 162.14);
  const Fat_util = vLanet.slice(0, arg_sAT).map(vl => (vl * VolRel) / 0.01576 * bw * 60 * 4.65 / 9.5 / 1000);
  
  
  
  
  
# 8. Steady State Lactate Concentrations
Based on the earlier described equation to calculate the AT the steady state lactate concentration for velocities below the AT can be calculated. The assumption of the steady state is that lactate production and elimination are equal. In the earlier part of this notebook the calculation for the production of lactate has already been discussed. So far the process of the invasion of pyruvate/lactate to the location of combustion (mitochondria) has been neglected. Pyruvate is converted into Acyl-CoA that can be brought into the citric acid cycle. This reaction is catalysed by the enzym pyruvatdehydrogenase (PDH). The activity of PDH consequently influences the accumulating lactate. PDH itself is activated mainly by the presence of pyruvate. The affinity of PDH towards pyruvate is dependent on the muscle fiber and described in the simulation by the constant Kel. In the original publication Mader and Heck suggested a value between 4 - 9, whereas it was assumed that Kel is 2 in a later paper. Based on these assumption the following equation holds true for the lactate concentration (CLass) below the threshold:


Calculating CLass below threshold 
Class = np.sqrt((vLamax * Kel * 60) / (((0.01576/ VolRel) * VO2ss[0:arg_sAT]) * (1 + (Ks2 / ((Ks1 * VO2ss[0:arg_sAT]) / (VO2max - VO2ss[0:arg_sAT])) ** (3 / 2))) - (vLamax * 60)))

Into Java:

//
function calculateSteadyStateLactate(VO2ss, vLamax, Kel, VolRel, Ks1, Ks2, VO2max, arg_sAT) {
  return VO2ss.slice(0, arg_sAT).map((vo2, index) => {
    return Math.sqrt(
      (vLamax * Kel * 60) /
        (
          (0.01576 / VolRel) * vo2 *
          (1 + (Ks2 / ((Ks1 * vo2) / (VO2max - vo2)) ** (3 / 2))) -
          vLamax * 60
        )
    );
  });
}



# 9. The rest is using google chart to plot the graphs! Thanks Rasaff57 for the input!


# 10. Additional factor to improve the code: 

Relative Lactate Distribution Space = 0.69 * Total Body Water (%), (Mader & Heck, 1986)

The active muscle mass must be calculated according to the sport. E.g. for cycling usually 65% of the total muscle mass is used. For running typically 75% is used. However, differences in active muscle mass are not (!) accounted for in this "simplistic" version of the model. If you want to include this, you must use the more advanced model (Mader 2003). We will hopefully have a working version of this up and running during the next year ;)

Also you could calculate Body Water (%), Muscle Mass (%) and lactate distribution space relative to the whole body based on body fat in percent (bf) using the following formulas (based on linear regression analysis).

Male:
Body Water = -0.68 * bf + 75
Muscle Mass = -0.42 * bf + 46.2
Lactate Distribution Space = -0.5 * bf + 55.13

Female:
Body Water = -0.73 * bf + 73.5
Muscle Mass = -0.47 * bf + 45
Lactate Distribution Space = -0.5364 * bf + 54.02






Generally energy (or ATP) is in this model produced during the oxidative pathway (VO2ss) and glycolysis (VLass). The problem now is that the amount of produced ATP per mmol of pyruvate is different than the amount per ml of oxygen combusted, but both need to be added together so consequently they need to be brought to the same unit. As locomotion cost is usually reported in oxygen units in the literature it makes sense to convert the energetic contribution of the gycolytic pathway into oxygen equivalents. If I now consider an athlete with the earlier given bodycomposition and assume the energy production of 2.36 VO2 ml/min/kg is equal to the pyruvate/lactate production of 1 mmol/L/min and calculate on the basis of this the oxygen energy equivalent for 1 mmol of pyruvate/lactate produced. So basically i am only converting units:

2.36 VO2 ml/min/kg = 1 VLa mmol/L/min

If 2.36 VO2 ml/min/kg are converted, this means that the entire body consumes 2.36 * 61.8 =145.85 ml/min (notice that the unit has changed from ml/min/kg to ml/min). Also I then need to know how much pyruvate/lactate is produced in the entire body, which is 1 * (61.8 * 0.4297) = 26.55 mmol/min (again the unit has changed from mmol/L/min to mmol/min). Therefore the following holds true:

145.85 VO2 ml/min = 26.55 VLa mmol/min

Lastly I need to divide by the right-hand side of the term to reach my intended goal (how much VO2 is needed to produce the same amount of energy in comparison to the production of 1 mmol of pyruvate/lactate).

145.85 / 26.55 = 26.55 / 26.55 == 5.5 ml = 1 mmol

Concerning the second question Mader uses in the 2003 Paper ATP-demand instead of oxygen-demand as the common unit. Bv,la (1.4, first use in eq. 21 in the paper) is the conversion factor of 1 mmol produced pyruvate to ATP and bvo2 (0.233, first use in eq. 23 in the paper) is the conversion factor of 1 ml consumed oxygen. Consequently 6 ml of oxygen is needed to produce the same amount of ATP as 1 mmol produced pyruvate (1.4 / 0.233 = 6).
